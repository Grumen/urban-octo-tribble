<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Витрина</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #222);
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 8px; /* Меньше расстояние между плитками */
            padding: 8px;
        }
        .card {
            min-width: 0;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            padding: 16px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .card img {
            width: 180px;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        .card-title {
            font-weight: bold;
            margin-bottom: 4px;
            text-align: center;
        }
        .card-price {
            color: var(--tg-theme-hint-color, #888);
            margin-bottom: 8px;
        }
        .card button {
            padding: 8px 16px;
            background: var(--tg-theme-button-color, #2aabee);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
        }
        /* Модальное окно */
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0; top: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.3);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #222);
            border-radius: 12px;
            padding: 24px;
            min-width: 280px;
            max-width: 90vw;
        }
        .qty-btn { width: 30px; height: 30px; }
        .ingredients { margin: 10px 0; }
        label { margin-right: 10px; }
        .close-btn {
            float: right;
            font-size: 20px;
            cursor: pointer;
            color: var(--tg-theme-hint-color, #888);
        }
        @media (max-width: 600px) {
            .container {
                grid-template-columns: repeat(2, 1fr);
            }
            .card img {
                width: 90px;
                height: 90px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="products"></div>

    <!-- Модальное окно заказа -->
    <div class="modal" id="orderModal">
        <div class="modal-content" id="modalContent">
            <!-- Динамически наполняется JS -->
        </div>
    </div>

    <script>
        Telegram.WebApp.ready();

        // Пример товаров
        const products = [
            {
                id: 1,
                name: "Пицца",
                price: 500,
                img: "https://img.freepik.com/free-photo/pizza-with-tomatoes-mushrooms_140725-5394.jpg?w=500",
                ingredients: [
                    {name: "сыр", price: 50},
                    {name: "бекон", price: 70},
                    {name: "грибы", price: 40}
                ]
            },
            {
                id: 2,
                name: "Суши",
                price: 300,
                img: "https://img.freepik.com/free-photo/sushi-set-leaves_140725-5392.jpg?w=500",
                ingredients: [
                    {name: "имбирь", price: 20},
                    {name: "васаби", price: 15},
                    {name: "соус", price: 10}
                ]
            },
            {
                id: 3,
                name: "Бургер",
                price: 350,
                img: "https://img.freepik.com/free-photo/burger-with-cheese-tomato-lettuce_140725-5393.jpg?w=500",
                ingredients: [
                    {name: "сыр", price: 30},
                    {name: "бекон", price: 40},
                    {name: "лук", price: 10}
                ]
            }
        ];

        // Рендерим плитки товаров
        const productsDiv = document.getElementById('products');
        products.forEach(product => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${product.img}" alt="${product.name}">
                <div class="card-title">${product.name}</div>
                <div class="card-price">${product.price}₽</div>
                <button onclick="openOrder(${product.id})">Заказать</button>
            `;
            productsDiv.appendChild(card);
        });

        // Открыть модальное окно заказа
        window.openOrder = function(productId) {
            const product = products.find(p => p.id === productId);
            let qty = 1;
            let selected = [];

            function renderModal() {
                let ingrHtml = product.ingredients.map(ing =>
                    `<label><input type="checkbox" value="${ing.name}" data-price="${ing.price}" onchange="updateOrder()"> ${ing.name} (+${ing.price}₽)</label>`
                ).join('');
                document.getElementById('modalContent').innerHTML = `
                    <span class="close-btn" onclick="closeModal()">&times;</span>
                    <h3>${product.name}</h3>
                    <img src="${product.img}" alt="${product.name}" style="width:100px;border-radius:8px;margin-bottom:10px;">
                    <div><b>Цена:</b> <span id="modalPrice">${product.price}</span>₽</div>
                    <div><b>Количество:</b>
                        <button class="qty-btn" onclick="changeQty(-1)">-</button>
                        <span id="modalQty">${qty}</span>
                        <button class="qty-btn" onclick="changeQty(1)">+</button>
                    </div>
                    <div class="ingredients"><b>Доп. ингредиенты:</b><br>${ingrHtml}</div>
                `;
                updateOrder();
            }

            window.changeQty = function(delta) {
                qty = Math.max(1, qty + delta);
                document.getElementById('modalQty').innerText = qty;
                updateOrder();
            };

            window.updateOrder = function() {
                selected = Array.from(document.querySelectorAll('#modalContent input[type=checkbox]:checked')).map(cb => cb.value);
                let total = product.price + Array.from(document.querySelectorAll('#modalContent input[type=checkbox]:checked')).reduce((sum, cb) => sum + Number(cb.getAttribute('data-price')), 0);
                document.getElementById('modalPrice').innerText = total * qty;
                Telegram.WebApp.MainButton.setText(`Оформить заказ на ${total * qty}₽`);
                Telegram.WebApp.MainButton.show();
            };

            Telegram.WebApp.MainButton.onClick(function() {
                let total = product.price + Array.from(document.querySelectorAll('#modalContent input[type=checkbox]:checked')).reduce((sum, cb) => sum + Number(cb.getAttribute('data-price')), 0);
                Telegram.WebApp.sendData(JSON.stringify({
                    item: product.name,
                    price: total * qty,
                    count: qty,
                    ingredients: selected
                }));
            });

            document.getElementById('orderModal').style.display = 'flex';
            renderModal();
        };

        window.closeModal = function() {
            document.getElementById('orderModal').style.display = 'none';
            Telegram.WebApp.MainButton.hide();
        };

        // Скрыть MainButton при открытии главной
        Telegram.WebApp.MainButton.hide();
    </script>
</body>
</html>

