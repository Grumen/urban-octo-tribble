<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Витрина</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #222);
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .item { margin-bottom: 20px; }
        .qty-btn { width: 30px; height: 30px; }
        .ingredients { margin: 10px 0; }
        label { margin-right: 10px; }
    </style>
</head>
<body>
    <h2>Пицца</h2>
    <div class="item">
        <b>Цена:</b> <span id="price">500</span>₽<br>
        <b>Количество:</b>
        <button class="qty-btn" onclick="changeQty(-1)">-</button>
        <span id="qty">1</span>
        <button class="qty-btn" onclick="changeQty(1)">+</button>
        <div class="ingredients">
            <b>Доп. ингредиенты:</b><br>
            <label><input type="checkbox" value="сыр" onchange="updateOrder()"> Сыр (+50₽)</label>
            <label><input type="checkbox" value="бекон" onchange="updateOrder()"> Бекон (+70₽)</label>
            <label><input type="checkbox" value="грибы" onchange="updateOrder()"> Грибы (+40₽)</label>
        </div>
    </div>
    <script>
        Telegram.WebApp.ready();

        let basePrice = 500;
        let qty = 1;
        let ingredients = [];
        let ingredientPrices = { "сыр": 50, "бекон": 70, "грибы": 40 };

        function changeQty(delta) {
            qty = Math.max(1, qty + delta);
            document.getElementById('qty').innerText = qty;
            updateOrder();
        }

        function updateOrder() {
            ingredients = Array.from(document.querySelectorAll('input[type=checkbox]:checked')).map(cb => cb.value);
            let total = basePrice + ingredients.reduce((sum, ing) => sum + ingredientPrices[ing], 0);
            document.getElementById('price').innerText = total * qty;
            // Обновляем MainButton
            Telegram.WebApp.MainButton.setText(`Оформить заказ на ${total * qty}₽`);
            Telegram.WebApp.MainButton.show();
        }

        Telegram.WebApp.MainButton.onClick(function() {
            let total = basePrice + ingredients.reduce((sum, ing) => sum + ingredientPrices[ing], 0);
            Telegram.WebApp.sendData(JSON.stringify({
                item: "Пицца",
                price: total * qty,
                count: qty,
                ingredients: ingredients
            }));
        });

        // Инициализация
        updateOrder();
    </script>
</body>
</html>
